# 3.7. Компьютерные сети, лекция 2

#### 1. Проверьте список доступных сетевых интерфейсов на вашем компьютере. Какие команды есть для этого в Linux и в Windows?

---
```bash
ubuntu:~$ ifconfig

>>> eth0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
...
>>> lo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536
...
```
```bash
C:\WINDOWS\system32>ipconfig

...
>>> Адаптер Ethernet Ethernet: Intel(R) Ethernet Controller (3) I225-V
...
>>> Адаптер Ethernet Ethernet 2: VirtualBox Host-Only Ethernet Adapter
...
>>> Адаптер Ethernet vEthernet (WSL): Hyper-V Virtual Ethernet Adapter
...
```

#### 2. Какой протокол используется для распознавания соседа по сетевому интерфейсу? Какой пакет и команды есть в Linux для этого?

---
LLDP - Link Layer Discovery Protocol

LLDPD - LLDP daemon

```bash
sudo apt install lldpd
systemctl enable lldpd && systemctl start lldpd
lldpctl
```
---

#### 3. Какая технология используется для разделения L2 коммутатора на несколько виртуальных сетей? Какой пакет и команды есть в Linux для этого? Приведите пример конфига.

---
VLAN

```bash
sudo apt install vlan
vim /etc/network/interfaces

cat /etc/network/interfaces

>>> auto eth0.101
>>> iface eth0.101 inet static
>>> address 192.168.101.2
>>> netmask 255.255.255.0
>>> vlan-raw-device eth0

sudo ip link add link eth0 name eth0.101 type vlan id 101
sudo ifconfig eth0.101 up
ip a

...
>>> eth0.101@eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default qlen 1000
...
```
---

#### 4. Какие типы агрегации интерфейсов есть в Linux? Какие опции есть для балансировки нагрузки? Приведите пример конфига.

---
Типы агрегации интерфейсов в Linux:

 - **Mode-0(balance-rr)** – Данный режим используется по умолчанию. Balance-rr обеспечивается балансировку нагрузки 
   и отказоустойчивость. В данном режиме сетевые пакеты отправляются “по кругу”, от первого интерфейса к 
   последнему. Если выходят из строя интерфейсы, пакеты отправляются на остальные оставшиеся. Дополнительной 
   настройки коммутатора не требуется при нахождении портов в одном коммутаторе. При разностных коммутаторах
   требуется дополнительная настройка.

 - **Mode-1(active-backup)** – Один из интерфейсов работает в активном режиме, остальные в ожидающем. 
   При обнаружении проблемы на активном интерфейсе производится переключение на ожидающий интерфейс.
   Не требуется поддержки от коммутатора.

 - **Mode-2(balance-xor)** – Передача пакетов распределяется по типу входящего и исходящего трафика по формуле
   ((MAC src) XOR (MAC dest)) % число интерфейсов. Режим дает балансировку нагрузки и отказоустойчивость. 
   Не требуется дополнительной настройки коммутатора/коммутаторов.

 - **Mode-3(broadcast)** – Происходит передача во все объединенные интерфейсы, тем самым обеспечивая отказоустойчивость.
   Рекомендуется только для использования MULTICAST трафика.

 - **Mode-4(802.3ad)** – динамическое объединение одинаковых портов. В данном режиме можно значительно увеличить пропускную
   способность входящего так и исходящего трафика. Для данного режима необходима поддержка и настройка
   коммутатора/коммутаторов.

 - **Mode-5(balance-tlb)** – Адаптивная балансировки нагрузки трафика. Входящий трафик получается только активным 
   интерфейсом, исходящий распределяется в зависимости от текущей загрузки канала каждого интерфейса. Не
   требуется специальной поддержки и настройки коммутатора/коммутаторов.

 - **Mode-6(balance-alb)** – Адаптивная балансировка нагрузки. Отличается более совершенным алгоритмом балансировки
   нагрузки чем Mode-5). Обеспечивается балансировку нагрузки как исходящего так и входящего трафика. Не требуется
   специальной поддержки и настройки коммутатора/коммутаторов.
 
Опции:

 - **miimon** - Число мс (тип integer) – как часто производится мониторинг MII статуса. 0 – мониторинг отключен.
   Рекомендуемое значение 100 мс.

 - **downdelay** - Задержка в мс (тип integer) с того момента, как было обнаружено, что связь пропала, до того,
   как данный канал перестанет использоваться. Задержка нужна, чтобы отфильтровывать кратковременные сбои.
   Например, после переключения патчкорда в течение нескольких секунд совсем не обязательно терять связь на
   минуту или больше. По умолчанию используется 0 – нет задержки.
 
 - **updelay** - То же самое, что и downdelay, но определяющее задержку по включению, на тот случай,
   если какой-нибудь switch или hub «не до конца включились». Напряжение на порт подано, а пакеты ещё
   корректно не принимаются. Если в этот момент передать данные – они потеряются, а если немного подождать,
   то этого не случится.

 - **arp_interval** - С какой периодичностью в мс (тип integer) осуществлять ARP-мониторинг. Значение 0 означает
   что ARP-мониторинг выключен.

 - **arp_ip_target** - IP-адрес, по которому осуществлять ARP-мониторинг (в случае если arp_interval>0).
   Если с данного адреса нет ARP-ответов, то значит канал, по которому посылались запросы, не работает.

```bash
cat /etc/network/interfaces

>>> auto bond0
>>> iface bond0 inet dhcp
>>>  bond-slaves none
>>>  bond-mode active-backup
>>>  bond-miimon 100

>>> auto eth0.100
>>> iface eth0.100 inet static
>>>  address 192,168.100.2
>>>  netmask 255.255.255.0
>>>  vlan-raw-device eth0
>>>  bond-master bond0
>>>  bond-primary eth0.100 eth0.101

>>> auto eth0.101
>>> iface eth0.101 inet static
>>>  address 192.168.101.2
>>>  netmask 255.255.255.0
>>>  vlan_raw_device eth0
>>>  bond-master bond0
>>>  bond-primary eth0.100 eth0.101
```
---

#### 5. Сколько IP адресов в сети с маской /29 ? Сколько /29 подсетей можно получить из сети с маской /24. Приведите несколько примеров /29 подсетей внутри сети 10.10.10.0/24.

---
 - ```bash
   ipcalc -b 192.168.0.0/29
   
   ...
   >>> Network:   192.168.0.0/29
   >>> HostMin:   192.168.0.1
   >>> HostMax:   192.168.0.6
   >>> Broadcast: 192.168.0.7
   >>> Hosts/Net: 6
   ```
   Ip-адресов = 8, из которых 2 служебных адреса: 0 и 7 и 6 адресов для использования
 - ```bash
   ipcalc -b 192.168.0.0/29
   
   >>> Hosts/Net: 254
   ```
   Сеть /24 содержит 256 Ip-адресов, каждая подсеть /29 заберет 8 адресов, подсетей можно получить: 256/8 = 32

 - ```bash
   ipcalc -b --split 6 6 6 192.168.0.0/24
   
   ...
   >>> 1. Requested size: 6 hosts
   >>> Netmask:   255.255.255.248 = 29
   >>> Network:   10.10.10.0/29
   >>> HostMin:   10.10.10.1
   >>> HostMax:   10.10.10.6
   >>> Broadcast: 10.10.10.7
   >>> Hosts/Net: 6                     Class A, Private Internet

   >>> 2. Requested size: 6 hosts
   >>> Netmask:   255.255.255.248 = 29
   >>> Network:   10.10.10.8/29
   >>> HostMin:   10.10.10.9
   >>> HostMax:   10.10.10.14
   >>> Broadcast: 10.10.10.15
   >>> Hosts/Net: 6                     Class A, Private Internet

   >>> 3. Requested size: 6 hosts
   >>> Netmask:   255.255.255.248 = 29
   >>> Network:   10.10.10.16/29
   >>> HostMin:   10.10.10.17
   >>> HostMax:   10.10.10.22
   >>> Broadcast: 10.10.10.23
   >>> Hosts/Net: 6                     Class A, Private Internet
   ...
   ```
---

#### 6. Задача: вас попросили организовать стык между 2-мя организациями. Диапазоны 10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16 уже заняты. Из какой подсети допустимо взять частные IP адреса? Маску выберите из расчета максимум 40-50 хостов внутри подсети.

---
Использовать адреса сети 100.64.0.0/10

```bash
ipcalc -b --split 50 100.64.0.0/10

...
>>> 1. Requested size: 50 hosts
>>> Netmask:   255.255.255.192 = 26
>>> Network:   100.64.0.0/26
>>> HostMin:   100.64.0.1
>>> HostMax:   100.64.0.62
>>> Broadcast: 100.64.0.63
>>> Hosts/Net: 62

>>> Needed size:  64 addresses.
>>> Used network: 100.64.0.0/26
```
---
#### 7. Как проверить ARP таблицу в Linux, Windows? Как очистить ARP кеш полностью? Как из ARP таблицы удалить только один нужный IP?

---
 - ```bash
   ubuntu:~$ arp
   >>> Address                  HWtype  HWaddress           Flags Mask            Iface
   >>> 10.0.2.3                 ether   52:54:00:12:35:03   C                     eth0
   >>> _gateway                 ether   52:54:00:12:35:02   C                     eth0
   
   ubuntu:~$ sudo ip neigh flush all
   ubuntu:~$ arp
   
   >>> Address                  HWtype  HWaddress           Flags Mask            Iface
   >>> _gateway                 ether   52:54:00:12:35:02   C                     eth0
   >>> _gateway                 ether   52:54:00:12:35:02   C                     eth0
   
   ubuntu:~$ sudo arp -d _gateway
   ubuntu:~$ arp
   
   >>> Address                  HWtype  HWaddress           Flags Mask            Iface
   >>> 10.0.2.3                 ether   52:54:00:12:35:03   C                     eth0
   >>> _gateway                 ether   52:54:00:12:35:02   C                     eth0
   ```

 - ```bash
   C:\WINDOWS\system32>arp -a
   
   ...
   >>> Интерфейс: 192.168.56.1
   >>>   адрес в Интернете      Физический адрес      Тип
   >>>   192.168.56.255        ff-ff-ff-ff-ff-ff     статический
   >>>   224.0.0.2             01-00-5e-00-00-02     статический
   >>>   224.0.0.22            01-00-5e-00-00-16     статический
   >>>   224.0.0.251           01-00-5e-00-00-fb     статический
   >>>   224.0.0.252           01-00-5e-00-00-fc     статический
   >>>   239.255.255.250       01-00-5e-7f-ff-fa     статический
   >>>   255.255.255.255       ff-ff-ff-ff-ff-ff     статический
   ...

   C:\WINDOWS\system32>arp –d # удалить кэш
   
   C:\WINDOWS\system32>arp –d 224.0.0.2 # удалить только один нужный IP
   ```
---
